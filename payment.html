<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AssignSavvy - Upgrade Plan</title>
  <link rel="stylesheet" href="./styles/main.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="./config/firebase-web.js"></script>
</head>
<body>
  <div class="payment-container">
    <h1>Upgrade Your Plan</h1>
    <p>Select a plan and unlock premium features.</p>

    <div class="plan-buttons">
      <button id="pro-plan-btn" class="btn btn-primary">Pro Plan - $9.99/month</button>
      <button id="custom-plan-btn" class="btn btn-outline">Custom Plan - $15 Top-up</button>
    </div>
  </div>

  <script>
    const API_BASE = "/api"; // Cloud Function endpoint prefix

    async function createCheckout(priceId) {
      const user = firebase.auth().currentUser;
      if (!user) {
        alert("Please log in first.");
        window.location.href = "auth.html";
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/create-checkout-session`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ uid: user.uid, priceId })
        });

        const data = await res.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          alert("Failed to create checkout session: " + (data.error || "Unknown error"));
        }
      } catch (err) {
        console.error("Checkout error:", err);
        alert("Something went wrong during checkout.");
      }
    }

    document.getElementById("pro-plan-btn")
      .addEventListener("click", () => createCheckout("price_12345")); // Replace with your Stripe Pro priceId

    document.getElementById("custom-plan-btn")
      .addEventListener("click", () => createCheckout("price_67890")); // Replace with your Stripe Custom priceId
  </script>
</body>
</html>
